
const express = require('express');
const http = require('http');
const { Server } = require("socket.io");
const path = require('path');

const app = express();
const server = http.createServer(app);
const io = new Server(server, { cors: { origin: "*" } });

// --- 20 TUNISIAN MYSTERIES DATABASE ---
const mysteriesDB = [
    {
        title: "Ù„ÙŠÙ„Ø© Ø§Ù„Ø¯Ù… ÙÙŠ Ø¹Ø±Ø³ Ø³ÙˆØ³Ø©",
        story: "ÙÙŠ Ø¹Ø±Ø³ ÙƒØ¨ÙŠØ± ÙÙŠ Ø³ÙˆØ³Ø©ØŒ Ø§Ù„Ø¹Ø±ÙŠØ³ ÙŠØ®ØªÙÙŠ Ù‚Ø¨Ù„ ØªÙ‚Ø·ÙŠØ¹ Ø§Ù„ÙƒÙŠÙƒ. ØªÙ„Ù‚Ø§ÙˆÙ‡ ÙÙŠ ØºØ±ÙØ© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù…Ø·Ø¹ÙˆÙ† Ø¨Ø³ÙƒÙŠÙ†Ø© Ø§Ù„Ø­Ù„ÙˆÙŠØ§Øª. Ø§Ù„Ù‚Ø§Ø¹Ø© Ù…Ø³ÙƒÙ‘Ø±Ø©ØŒ ÙˆØ§Ù„Ù‚Ø§ØªÙ„ ÙˆØ§Ø­Ø¯ Ù…Ù†ÙƒÙ….",
        killerDesc: "Ø§Ù„Ù„ÙŠ Ù„Ø§Ø¨Ø³ Ø¨Ø¯Ù„Ø© Ø²Ø±Ù‚Ø§Ø¡ ÙˆØ¹Ù†Ø¯Ùˆ Ø³Ø§Ø¹Ø© Ø°Ù‡Ø¨ ÙƒØ¨ÙŠØ±Ø©",
        clues: [
            "Ø§Ù„Ø¨Ø§Ø¨ Ù…Ø³ÙƒÙ‘Ø± Ù…Ù† Ø§Ù„Ø¯Ø§Ø®Ù„ØŒ Ù…Ø§ ÙÙ…Ø§Ø´ ÙƒØ³Ø±.",
            "Ø³Ø§Ø¹Ø© Ø°Ù‡Ø¨ Ø·Ø§ÙŠØ­Ø© ØªØ­Øª Ø§Ù„Ø·Ø§ÙˆÙ„Ø©.",
            "Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ØªÙˆØ±Ù‘ÙŠ Ø¨Ø¯Ù„Ø© Ø²Ø±Ù‚Ø§Ø¡ Ø¯Ø§Ø®Ù„Ø© Ù‚Ø¨Ù„ 7 Ø¯Ù‚Ø§ÙŠÙ‚.",
            "Ø¨ØµÙ…Ø§Øª (Ø§Ù„Ù‚Ø§ØªÙ„) Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙƒÙŠÙ†Ø©."
        ],
        rumors: ["Ø´Ø§ÙÙˆ ÙˆØ§Ø­Ø¯ ÙŠØºØ³Ù„ ÙŠØ¯ÙŠÙ‡ ÙˆÙ…Ø±Ø¨Ùƒ.", "Ø³Ù…Ø¹Ùˆ Ø¹Ø±ÙƒØ© Ù‚Ø¯ÙŠÙ…Ø© Ø¹Ù„Ù‰ ÙÙ„ÙˆØ³."],
        secret: "Ø¯Ø§ÙØ¹ Ø¹Ù„Ù‰ ØµØ§Ø­Ø¨ Ø§Ù„Ø¨Ø¯Ù„Ø© Ø§Ù„Ø²Ø±Ù‚Ø§Ø¡ ÙˆÙŠØ´ÙƒÙƒ ÙÙŠ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§."
    },
    {
        title: "ØºØ¯Ø±Ø© ÙÙŠ Ø±Ø­Ù„Ø© Ø¨Ø­Ø±ÙŠØ©",
        story: "ÙÙŠ ÙŠØ®Øª Ø®Ø§ØµØŒ ÙˆØ§Ø­Ø¯ ÙŠØ·ÙŠØ­ ÙÙŠ Ø§Ù„Ø¨Ø­Ø± Ø¨Ø§Ù„Ù„ÙŠÙ„. Ø§Ù„ØµØ¨Ø§Ø­ ÙŠÙ„Ù‚Ø§Ùˆ Ø¬Ø§ÙƒÙŠØªÙ‡ Ù…Ù‚ØµÙˆØµØ©.",
        killerDesc: "Ø§Ù„Ù„ÙŠ Ø¹Ù†Ø¯Ùˆ ÙˆØ´Ù… Ø­ÙˆØª ÙÙŠ ÙŠØ¯Ùˆ Ø§Ù„ÙŠØ³Ø§Ø±",
        clues: [
            "Ø§Ù„Ø¬Ø§ÙƒÙŠØªØ© Ù…Ù‚ØµÙˆØµØ© Ø¨Ø³ÙƒÙŠÙ† ØµØºÙŠØ±.",
            "Ø³ÙƒÙŠÙ† Ù…Ø·Ø¨Ø® Ù†Ø§Ù‚Øµ Ù…Ù† Ø§Ù„ÙŠØ®Øª.",
            "Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ØªÙˆØ±Ù‘ÙŠ ÙˆØ´Ù… ÙˆØ§Ø¶Ø­.",
            "Ø¢Ø«Ø§Ø± Ù…Ù„Ø­ Ø¹Ù„Ù‰ Ø³Ø±ÙˆØ§Ù„ (Ø§Ù„Ù‚Ø§ØªÙ„)."
        ],
        rumors: ["Ø§Ù„Ø¶Ø­ÙŠØ© ÙƒØ§Ù† Ù…Ø¯ÙŠÙˆÙ†.", "ÙˆØ§Ø­Ø¯ Ù‚Ø§Ù„ 'ÙŠØ§ Ù„ÙŠØªÙˆ ÙŠØ®ØªÙÙŠ'."],
        secret: "Ø±ÙƒÙ‘Ø² Ø§Ù„Ø­Ø¯ÙŠØ« Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙŠÙˆÙ†."
    },
    {
        title: "Ø³Ø± Ø§Ù„ÙÙŠÙ„Ø§ Ø§Ù„Ù…Ù‡Ø¬ÙˆØ±Ø©",
        story: "Ø¯Ø®Ù„ØªÙˆ ÙÙŠÙ„Ø§ Ù…Ù‡Ø¬ÙˆØ±Ø© ÙƒØªØ­Ø¯ÙŠ. ÙˆØ§Ø­Ø¯ Ù…Ø§ Ø®Ø±Ø¬Ø´. ØªÙ„Ù‚Ø§ÙˆÙ‡ Ù…Ø®Ù†ÙˆÙ‚ ÙÙŠ Ø§Ù„Ù‚Ø¨Ùˆ.",
        killerDesc: "Ø§Ù„Ù„ÙŠ ÙƒØ§Ù† Ø¯Ø§ÙŠÙ…Ø§Ù‹ ÙŠÙ‚ÙˆÙ„ 'Ø£Ù†Ø§ Ù…Ø§ Ù†Ø®Ø§ÙØ´'",
        clues: [
            "Ù…Ø§ ÙÙ…Ø§Ø´ Ø¢Ø«Ø§Ø± ÙƒØ³Ø±.",
            "Ø­Ø¨Ù„ ÙÙŠ Ø´Ù†Ø·Ø© (Ø§Ù„Ù‚Ø§ØªÙ„).",
            "ÙÙŠØ¯ÙŠÙˆ ÙŠÙˆØ±ÙŠ (Ø§Ù„Ù‚Ø§ØªÙ„) Ù†Ø§Ø²Ù„ ÙˆØ­Ø¯Ùˆ Ù„Ù„Ù‚Ø¨Ùˆ.",
            "Ø£Ù„ÙŠØ§Ù Ø§Ù„Ø­Ø¨Ù„ ØªØ·Ø§Ø¨Ù‚."
        ],
        rumors: ["Ø§Ù„Ø¶Ø­ÙŠØ© ÙƒØ§Ù† Ø¨Ø§Ø´ ÙŠÙƒØ´Ù Ø³Ø±.", "ÙˆØ§Ø­Ø¯ Ø®Ø±Ø¬ Ù‚Ø¨Ù„ Ø§Ù„ÙˆÙ‚Øª."],
        secret: "Ø¯Ø§ÙØ¹ Ø¹Ù„Ù‰ ØµØ§Ø­Ø¨ Ø§Ù„Ø­Ø¨Ù„."
    },
    {
        title: "Ø§Ù„Ø³Ù… ÙÙŠ Ø§Ù„Ù‚Ù‡ÙˆØ©",
        story: "ÙÙŠ Ù‚Ø¹Ø¯Ø©ØŒ ÙˆØ§Ø­Ø¯ ÙŠØ´Ø±Ø¨ Ù‚Ù‡ÙˆØ© ÙˆÙŠØ·ÙŠØ­ Ù…ÙŠØª.",
        killerDesc: "Ø§Ù„Ù„ÙŠ Ø­Ø¶Ù‘Ø± Ø§Ù„Ù‚Ù‡ÙˆØ©",
        clues: [
            "Ø§Ù„Ø³Ù… ÙƒØ§Ù† ÙÙŠ ÙÙ†Ø¬Ø§Ù† ÙˆØ§Ø­Ø¯.",
            "(Ø§Ù„Ù‚Ø§ØªÙ„) ÙˆØ­Ø¯Ùˆ ÙƒØ§Ù† ÙÙŠ Ø§Ù„Ù…Ø·Ø¨Ø®.",
            "Ø¨ØµÙ…Ø§Øª (Ø§Ù„Ù‚Ø§ØªÙ„) Ø¹Ù„Ù‰ Ø¹Ù„Ø¨Ø© Ø§Ù„Ø³Ù….",
            "Ø¨Ø­Ø« ÙÙŠ ØªÙ„ÙÙˆÙ† (Ø§Ù„Ù‚Ø§ØªÙ„) Ø¹Ù„Ù‰ Ø¬Ø±Ø¹Ø© Ù‚Ø§ØªÙ„Ø©."
        ],
        rumors: ["Ø§Ù„Ø¶Ø­ÙŠØ© ÙŠØ®ÙˆÙ† Ù…Ø±ØªÙˆ.", "ÙˆØ§Ø­Ø¯ Ø¨Ø¯Ù‘Ù„ Ø§Ù„ÙÙ†Ø§Ø¬ÙŠÙ†."],
        secret: "Ø§ØªÙ‡Ù… Ø§Ù„Ù„ÙŠ Ø¨Ø¯Ù‘Ù„ Ø§Ù„ÙÙ†Ø§Ø¬ÙŠÙ†."
    },
    {
        title: "ÙÙ„ÙˆØ³ Ø§Ù„Ø±Ø­Ù„Ø©",
        story: "ÙÙ„ÙˆØ³ Ø§Ù„Ø±Ø­Ù„Ø© ØªØ®ØªÙÙŠ ÙˆÙˆØ§Ø­Ø¯ ÙŠØªÙ„Ù‚Ù‰ Ù…Ø¶Ø±ÙˆØ¨.",
        killerDesc: "Ø§Ù„Ù„ÙŠ Ø­Ø°Ø§Ø¤Ùˆ Ø£Ø¨ÙŠØ¶ ÙˆÙ…ØªÙˆØ³Ø® Ø¨Ø§Ù„Ø·ÙŠÙ†",
        clues: [
            "Ø§Ù„Ø·ÙŠÙ† Ù†ÙØ³Ùˆ Ù‚Ø¯Ø§Ù… Ø§Ù„Ù…Ø®Ø²Ù†.",
            "Ø¨ØµÙ…Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø­Ù‚ÙŠØ¨Ø©.",
            "ÙƒØ§Ù…ÙŠØ±Ø§ ØªÙˆØ±Ù‘ÙŠ Ø§Ù„Ø­Ø°Ø§Ø¡ Ø§Ù„Ø£Ø¨ÙŠØ¶.",
            "Ø§Ù„ÙÙ„ÙˆØ³ ÙÙŠ Ø³ÙŠØ§Ø±Ø© (Ø§Ù„Ù‚Ø§ØªÙ„)."
        ],
        rumors: ["Ø§Ù„Ø¶Ø­ÙŠØ© Ø¨Ø¯Ù‘Ù„ Ø§Ù„ÙˆØ¬Ù‡Ø©.", "Ø´Ø§ÙÙˆÙ‡ ÙŠØ¬Ø±ÙŠ."],
        secret: "Ù‚Ù„Ù„ Ù…Ù† Ø£Ù‡Ù…ÙŠØ© Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø­Ø°Ø§Ø¡."
    },
    {
        title: "Ø­Ø±ÙŠÙ‚ Ø§Ù„Ù…Ø®ÙŠÙ…",
        story: "Ø§Ù„Ù†Ø§Ø± Ø´Ø¹Ù„Øª ÙÙŠ Ø§Ù„Ù…Ø®ÙŠÙ… ÙˆØ§Ù„Ø¶Ø­ÙŠØ© ØªØ­Ø±Ù‚.",
        killerDesc: "Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„ØºØ§Ø²",
        clues: ["Ø±ÙŠØ­Ø© Ø¨Ù†Ø²ÙŠÙ† Ù‚ÙˆÙŠØ©.", "Ø¯Ø¨ÙˆØ³Ø© Ø§Ù„ØºØ§Ø² Ù…Ø­Ù„ÙˆÙ„Ø©.", "ÙˆÙ„Ø§Ø¹Ø© (Ø§Ù„Ù‚Ø§ØªÙ„) ÙÙŠÙ‡Ø§ Ø¢Ø«Ø§Ø± Ø¨Ù†Ø²ÙŠÙ†.", "Ø´Ù‡ÙˆØ¯ Ø´Ø§ÙÙˆ (Ø§Ù„Ù‚Ø§ØªÙ„) Ø¨Ø­Ø°Ø§ Ø§Ù„Ø®ÙŠÙ…Ø©."],
        rumors: ["ÙˆØ§Ø­Ø¯ ÙƒØ§Ù† ÙŠØªØ´ÙƒÙ‰ Ù…Ù† Ø§Ù„Ø¨Ø±Ø¯.", "ÙÙ…Ø§ Ø¹Ø±ÙƒØ© Ø¹Ù„Ù‰ Ø¨Ù„Ø§ØµØ© Ø§Ù„Ù†ÙˆÙ…."],
        secret: "Ø§ØªÙ‡Ù… Ø§Ù„Ù„ÙŠ ÙŠØªØ´ÙƒÙ‰ Ù…Ù† Ø§Ù„Ø¨Ø±Ø¯."
    },
    {
        title: "Ø­Ø§Ø¯Ø« ÙÙŠ Ø§Ù„Ø¬ÙŠÙ…",
        story: "ÙˆØ§Ø­Ø¯ ØªØ·ÙŠØ­ Ø¹Ù„ÙŠÙ‡ Ø­Ø¯ÙŠØ¯Ø© ÙˆÙŠÙ…ÙˆØª Ù…Ø®Ù†ÙˆÙ‚.",
        killerDesc: "Ø§Ù„Ù„ÙŠ ÙŠÙ„Ø¨Ø³ Ù‚ÙØ§Ø²Ø§Øª Ø³ÙˆØ¯",
        clues: ["Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙƒØ§Ù†Øª Ù…Ø³ÙƒØ±Ø©.", "Ø¢Ø«Ø§Ø± Ø®Ù†Ù‚ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù‚Ø¨Ø©.", "Ù‚ÙØ§Ø²Ø§Øª Ø³ÙˆØ¯ Ø¨Ø­Ø°Ø§ Ø§Ù„Ø¬Ø«Ø©.", "Ø¨ØµÙ…Ø§Øª (Ø§Ù„Ù‚Ø§ØªÙ„) Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø¯ÙŠØ¯Ø©."],
        rumors: ["Ø§Ù„Ø¶Ø­ÙŠØ© ÙƒØ§Ù† ÙŠÙØ±Ùƒ ÙÙŠÙ‡Ù….", "ÙÙ…Ø§ ØºÙŠØ±Ø© Ø±ÙŠØ§Ø¶ÙŠØ©."],
        secret: "Ù‚ÙˆÙ„ Ø§Ù„Ù„ÙŠ Ù‡Ùˆ Ø­Ø§Ø¯Ø« Ù‚Ø¶Ø§Ø¡ ÙˆÙ‚Ø¯Ø±."
    },
    {
        title: "Ù„ÙŠÙ„Ø© Ø±Ø£Ø³ Ø§Ù„Ø³Ù†Ø©",
        story: "ÙÙŠ ÙˆØ³Ø· Ø§Ù„Ø§Ø­ØªÙØ§Ù„ØŒ ÙˆØ§Ø­Ø¯ ÙŠØ·ÙŠØ­ Ù…ÙŠØª.",
        killerDesc: "Ø§Ù„Ù„ÙŠ Ø¬Ø§Ø¨ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ù†Ø§Ø±ÙŠØ©",
        clues: ["Ø±ÙŠØ­Ø© Ø¨Ø§Ø±ÙˆØ¯ Ù‚ÙˆÙŠØ©.", "Ø£ØµØ§Ø¨Ø¹ (Ø§Ù„Ù‚Ø§ØªÙ„) Ù…Ø­Ø±ÙˆÙ‚Ø©.", "Ù…Ø§Ø¯Ø© Ù…ØªÙØ¬Ø±Ø© ÙÙŠ Ø¬ÙŠØ¨ (Ø§Ù„Ù‚Ø§ØªÙ„).", "Ø±Ø³Ø§Ù„Ø© ØªÙ‡Ø¯ÙŠØ¯."],
        rumors: ["ÙƒØ§Ù†Ùˆ ÙŠØªØ¹Ø§Ø±ÙƒÙˆ.", "Ø§Ù„Ø¶Ø­ÙŠØ© Ø³ÙƒØ±Ø§Ù†."],
        secret: "Ø¯Ø§ÙØ¹ Ø¹Ù„Ù‰ Ø§Ù„Ù„ÙŠ Ø¬Ø§Ø¨ Ø§Ù„ÙÙˆØ´ÙŠÙƒ."
    },
    {
        title: "Ø§Ø®ØªÙØ§Ø¡ ÙÙŠ Ø±Ø­Ù„Ø© Ø¬Ø¨Ù„",
        story: "ÙˆØ§Ø­Ø¯ Ø¶Ø§Ø¹ ÙÙŠ Ø§Ù„Ø¬Ø¨Ù„ ÙˆÙ„Ù‚Ø§ÙˆÙ‡ Ù…ÙŠØª ÙÙŠ Ø­ÙØ±Ø©.",
        killerDesc: "Ø§Ù„Ù„ÙŠ ÙƒØ§Ù† Ù…Ø§Ø³Ùƒ Ø§Ù„Ø®Ø±ÙŠØ·Ø©",
        clues: ["Ø§Ù„Ù…Ø³Ø§Ø± Ù…ØªØ¨Ø¯Ù„ Ø¨Ø§Ù„Ø¹Ø§Ù†ÙŠ.", "Ø¢Ø«Ø§Ø± Ø¯ÙØ¹ Ù…Ù† Ø§Ù„Ø®Ù„Ù.", "Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø¹Ù†Ø¯ (Ø§Ù„Ù‚Ø§ØªÙ„).", "Ø´Ù‡Ø§Ø¯Ø©: (Ø§Ù„Ù‚Ø§ØªÙ„) Ù‚Ø§Ù„Ùˆ Ø¨Ø±Ø§ Ù…Ù† Ù‡Ù†Ø§."],
        rumors: ["Ø§Ù„Ø¶Ø­ÙŠØ© ØªØ¹Ø¨.", "ÙÙ…Ø§ Ø°ÙŠØ¨ ÙÙŠ Ø§Ù„Ø¬Ø¨Ù„."],
        secret: "Ù‚ÙˆÙ„ Ø§Ù„Ù„ÙŠ Ù‡Ùˆ Ø·Ø§Ø­ ÙˆØ­Ø¯Ùˆ."
    },
    {
        title: "Ø¬Ø±ÙŠÙ…Ø© ÙÙŠ Ø¨ÙŠØª Ø§Ù„Ø·Ù„Ø¨Ø©",
        story: "Ø·Ø§Ù„Ø¨ Ù„Ù‚Ø§ÙˆÙ‡ Ù…ÙŠØª ÙÙŠ Ø¨ÙŠØªÙˆ ÙˆØ§Ù„Ø¨Ø§Ø¨ Ù…Ø³ÙƒØ±.",
        killerDesc: "Ø§Ù„Ù„ÙŠ Ø¹Ù†Ø¯Ùˆ Ù…ÙØ§ØªÙŠØ­ Ø¥Ø¶Ø§ÙÙŠØ©",
        clues: ["Ù…Ø§ ÙÙ…Ø§Ø´ ÙƒØ³Ø±.", "Ù†Ø³Ø®Ø© Ù…ÙØªØ§Ø­ Ø¹Ù†Ø¯ (Ø§Ù„Ù‚Ø§ØªÙ„).", "ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø¹Ù…Ø§Ø±Ø© ØµÙˆØ±Øª (Ø§Ù„Ù‚Ø§ØªÙ„).", "Ø¯Ù… Ø¹Ù„Ù‰ Ù…ÙØªØ§Ø­ (Ø§Ù„Ù‚Ø§ØªÙ„)."],
        rumors: ["ÙŠØ³Ù…Ø¹ ÙÙŠ Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø¹Ø§Ù„ÙŠØ©.", "Ø¹Ø±ÙƒØ© Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ±Ø§Ø¡."],
        secret: "Ø´ÙƒÙƒ ÙÙŠ Ø¬ÙˆØ¯Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§."
    },
    {
        title: "ØªØ³Ù…Ù… ÙÙŠ Ø´ÙˆØ§Ø¡",
        story: "Ø´ÙˆØ§Ø¡ ÙÙŠ Ø§Ù„ØºØ§Ø¨Ø©ØŒ ÙˆØ§Ø­Ø¯ ÙƒÙ„Ø§ ÙˆÙ…Ø§Øª.",
        killerDesc: "Ø§Ù„Ù„ÙŠ Ø¬Ø§Ø¨ Ø§Ù„Ù„Ø­Ù…",
        clues: ["Ø§Ù„Ù„Ø­Ù… ÙƒØ§Ù† ÙÙŠÙ‡ Ø±ÙŠØ­Ø© ØºØ±ÙŠØ¨Ø©.", "Ù…Ø§Ø¯Ø© Ø³Ø§Ù…Ø© ÙÙŠ Ø´Ù†Ø·Ø© (Ø§Ù„Ù‚Ø§ØªÙ„).", "(Ø§Ù„Ù‚Ø§ØªÙ„) Ù…Ø§ ÙƒÙ„Ø§ Ø´ÙˆØ§.", "Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„ Ø£Ø«Ø¨ØªØª Ø§Ù„ØªØ³Ù…Ù…."],
        rumors: ["Ø§Ù„Ù„Ø­Ù… ÙØ§Ø³Ø¯.", "Ø§Ù„Ø¶Ø­ÙŠØ© Ø¹Ù†Ø¯Ùˆ Ø­Ø³Ø§Ø³ÙŠØ©."],
        secret: "Ù‚ÙˆÙ„ Ø§Ù„Ù„ÙŠ Ø§Ù„Ù„Ø­Ù… ÙØ§Ø³Ø¯ Ù…Ø´ Ù…Ø³Ù…ÙˆÙ…."
    },
    {
        title: "Ø³Ø±Ù‚Ø© Ù…Ø­Ù„",
        story: "Ù…Ø­Ù„ ØªØ³Ø±Ù‚ ÙˆÙ…ÙˆÙ„Ø§Ù‡ ØªÙ‚ØªÙ„.",
        killerDesc: "Ø§Ù„Ù„ÙŠ ÙƒØ§Ù† ÙŠØ®Ø¯Ù… part-time",
        clues: ["Ø§Ù„Ø®Ø²Ù†Ø© Ù…Ø­Ù„ÙˆÙ„Ø© Ø¨Ø§Ù„ÙƒÙˆØ¯.", "Ø¨ØµÙ…Ø§Øª (Ø§Ù„Ù‚Ø§ØªÙ„) Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø²Ù†Ø©.", "ØºÙŠØ§Ø¨ (Ø§Ù„Ù‚Ø§ØªÙ„) ÙˆÙ‚Øª Ø§Ù„Ø¬Ø±ÙŠÙ…Ø©.", "Ø§Ù„ÙÙ„ÙˆØ³ Ù…Ø®Ø¨ÙŠØ© Ø¹Ù†Ø¯ (Ø§Ù„Ù‚Ø§ØªÙ„)."],
        rumors: ["Ø¹Ù†Ø¯Ùˆ Ø¯ÙŠÙˆÙ†.", "Ø§Ù„Ù…ÙˆÙ„Ù‰ Ø¸Ø§Ù„Ù…."],
        secret: "Ø¯Ø§ÙØ¹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø¯Ø§Ù…."
    },
    {
        title: "ØºØ¯Ø±Ø© ÙÙŠ Ù…Ù‚Ø§Ø¨Ù„Ø© ÙƒÙˆØ±Ø©",
        story: "ÙÙŠ ÙˆØ³Ø· Ø§Ù„Ù…Ø§ØªØ´ØŒ Ù…Ù„Ø§Ø¹Ø¨ÙŠ ÙŠØ·ÙŠØ­ ÙˆÙ…Ø§ ÙŠÙ‚ÙˆÙ…Ø´.",
        killerDesc: "Ø§Ù„Ù„ÙŠ ÙƒØ§Ù† Ø§Ø­ØªÙŠØ§Ø·ÙŠ",
        clues: ["Ø¶Ø±Ø¨Ø© Ù…ØªØ¹Ù…Ø¯Ø©.", "Ø¯ÙØ¹Ùˆ Ù‚Ø¯Ø§Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§.", "Ø­Ø°Ø§Ø¡ (Ø§Ù„Ù‚Ø§ØªÙ„) ÙÙŠÙ‡ Ø¯Ù….", "Ø´Ù‡ÙˆØ¯ Ø³Ù…Ø¹Ùˆ ØªÙ‡Ø¯ÙŠØ¯."],
        rumors: ["Ø§Ù„Ø­Ø§Ø±Ø³ Ø¨Ù„Ø¹Ø§Ù†ÙŠ.", "Ø§Ù„Ø¶Ø­ÙŠØ© ÙŠÙ…Ø«Ù„."],
        secret: "Ø§ØªÙ‡Ù… Ø§Ù„Ø­Ø§Ø±Ø³."
    },
    {
        title: "Ø¬Ø±ÙŠÙ…Ø© ÙÙŠ Ø³Ù‡Ø±Ø© Ø±Ø¹Ø¨",
        story: "Ø³Ù‡Ø±Ø© Ø£ÙÙ„Ø§Ù… Ø±Ø¹Ø¨ØŒ ÙˆØ§Ø­Ø¯ Ù…Ø§Øª Ø¨Ø§Ù„Ø­Ù‚.",
        killerDesc: "Ø§Ù„Ù„ÙŠ Ø¬Ø§Ø¨ Ù‚Ù†Ø§Ø¹ Ø£Ø³ÙˆØ¯",
        clues: ["Ø³Ù„Ø§Ø­ Ø­Ù‚ÙŠÙ‚ÙŠ Ø¨Ø¯Ù„ Ø§Ù„Ù„Ø¹Ø¨Ø©.", "Ø£Ù„ÙŠØ§Ù Ø§Ù„Ù‚Ù†Ø§Ø¹ ÙÙŠ Ù…Ø³Ø±Ø­ Ø§Ù„Ø¬Ø±ÙŠÙ…Ø©.", "Ù‚Ù†Ø§Ø¹ (Ø§Ù„Ù‚Ø§ØªÙ„) ÙÙŠÙ‡ Ø¯Ù….", "Ø¨ØµÙ…Ø§Øª (Ø§Ù„Ù‚Ø§ØªÙ„)."],
        rumors: ["ÙƒØ§Ù† ÙŠØµØ±Ø® Ø¨Ø±Ø´Ø§.", "ÙÙŠÙ„Ù… Ø±Ø¹Ø¨ ÙˆÙ„Ø§ Ø­Ù‚ÙŠÙ‚Ø©."],
        secret: "Ù‚ÙˆÙ„ Ø§Ù„Ù„ÙŠ Ù‡Ùˆ ÙŠÙ…Ø«Ù„."
    },
    {
        title: "Ø­Ø§Ø¯Ø« Ø³ÙŠØ§Ø±Ø© Ù…ØªØ¹Ù…Ø¯",
        story: "ÙƒØ±Ù‡Ø¨Ø© ØªÙ‚Ù„Ø¨Øª ÙˆØ§Ù„ÙØ±Ø§Ù…Ù„ Ù…Ù‚Ø·ÙˆØ¹Ø©.",
        killerDesc: "Ø§Ù„Ù„ÙŠ ÙƒØ§Ù† ÙŠØ³ÙˆÙ‚ Ù‚Ø¨Ù„Ùˆ",
        clues: ["Ø§Ù„ÙØ±Ø§Ù…Ù„ Ù…Ù‚Ø·ÙˆØ¹Ø© Ø¨Ø¢Ù„Ø© Ø­Ø§Ø¯Ø©.", "Ø¢Ø«Ø§Ø± Ø²ÙŠØª Ø¹Ù„Ù‰ ÙŠØ¯ (Ø§Ù„Ù‚Ø§ØªÙ„).", "ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„ÙƒÙŠØ§Ø³.", "Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ù…ÙŠÙƒØ§Ù†ÙŠØ³ÙŠØ§Ù†."],
        rumors: ["ÙƒØ§Ù† Ø³ÙƒØ±Ø§Ù†.", "Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø®Ø§ÙŠØ¨."],
        secret: "Ù„ÙˆÙ… Ø¹Ù„Ù‰ Ø­Ø§Ù„Ø© Ø§Ù„ÙƒÙŠØ§Ø³."
    },
    {
        title: "Ø³Ø± ÙÙŠ Ù…Ø´Ø±ÙˆØ¹ Ù…Ø´ØªØ±Ùƒ",
        story: "Ø´Ø±ÙŠÙƒ ØªÙ‚ØªÙ„ ÙÙŠ Ø¨ÙŠØ±ÙˆÙ‡.",
        killerDesc: "Ø§Ù„Ø´Ø±ÙŠÙƒ Ø§Ù„Ø«Ø§Ù†ÙŠ",
        clues: ["ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ Ù…Ø´Ø¨ÙˆÙ‡.", "Ø¹Ø±ÙƒØ© Ù‚Ø¨Ù„ Ø¨Ù†Ù‡Ø§Ø±.", "Ø¨ØµÙ…Ø§Øª (Ø§Ù„Ù‚Ø§ØªÙ„) Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„Ù.", "Ø³Ù„Ø§Ø­ ÙÙŠ Ù…ÙƒØªØ¨ (Ø§Ù„Ù‚Ø§ØªÙ„)."],
        rumors: ["Ø§Ù„Ù…ÙˆØ¸Ù ÙŠØ³Ø±Ù‚.", "Ø¥ÙÙ„Ø§Ø³ Ø§Ù„Ø´Ø±ÙƒØ©."],
        secret: "Ø§ØªÙ‡Ù… Ø§Ù„Ù…ÙˆØ¸Ù."
    },
    {
        title: "Ù…ÙˆØª ÙÙŠ Ù…Ø³Ø¨Ø­",
        story: "Ø­ÙÙ„Ø© Ù…Ø³Ø¨Ø­ØŒ ÙˆØ§Ø­Ø¯ ØºØ±Ù‚.",
        killerDesc: "Ø§Ù„Ù„ÙŠ ÙŠØ¹Ø±Ù ÙŠØ¹ÙˆÙ… Ù…Ù„ÙŠØ­",
        clues: ["Ø®Ø¯ÙˆØ´ Ø¹Ù„Ù‰ Ø°Ø±Ø§Ø¹ Ø§Ù„Ø¶Ø­ÙŠØ©.", "Ø¢Ø«Ø§Ø± Ø®Ù†Ù‚ ØªØ­Øª Ø§Ù„Ù…Ø§Ø¡.", "(Ø§Ù„Ù‚Ø§ØªÙ„) ÙƒØ§Ù† Ø¨Ø­Ø°Ø§Ù‡.", "Ø³Ø§Ø¹Ø© Ø§Ù„Ø¶Ø­ÙŠØ© Ø¹Ù†Ø¯ (Ø§Ù„Ù‚Ø§ØªÙ„)."],
        rumors: ["Ù…Ø§ ÙŠØ¹Ø±ÙØ´ ÙŠØ¹ÙˆÙ….", "ØªØ´Ù†Ø¬ Ø¹Ø¶Ù„ÙŠ."],
        secret: "Ù‚ÙˆÙ„ Ø§Ù„Ù„ÙŠ Ù‡Ùˆ ØºØ±Ù‚ ÙˆØ­Ø¯Ùˆ."
    },
    {
        title: "ØªØ³Ù…Ù… ÙÙŠ Ø­ÙÙ„Ø© Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯",
        story: "Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯ØŒ Ø§Ù„Ø¶Ø­ÙŠØ© ÙƒÙ„Ø§ Ø§Ù„Ù‚Ø§Ø·Ùˆ ÙˆÙ…Ø§Øª.",
        killerDesc: "Ø§Ù„Ù„ÙŠ Ù‚ØµÙ‘ Ø§Ù„ÙƒÙŠÙƒ",
        clues: ["Ø§Ù„Ø³Ù… ÙÙŠ Ø·Ø±Ù Ø§Ù„Ø³ÙƒÙŠÙ†Ø©.", "Ø³Ù… ÙÙŠ Ø¬ÙŠØ¨ (Ø§Ù„Ù‚Ø§ØªÙ„).", "(Ø§Ù„Ù‚Ø§ØªÙ„) Ø£ØµØ± Ø¨Ø§Ø´ ÙŠÙ‚Øµ.", "Ø¨ØµÙ…Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙƒÙŠÙ†Ø©."],
        rumors: ["ÙŠØºØ§Ø± Ù…Ù† Ø§Ù„Ø¶Ø­ÙŠØ©.", "Ø§Ù„Ù‚Ø§Ø·Ùˆ Ø¨Ø§ÙŠØª."],
        secret: "Ù„ÙˆÙ… Ø¹Ù„Ù‰ Ù…ÙˆÙ„Ù‰ Ø§Ù„Ø¨Ø§ØªÙŠØ³Ø±ÙŠ."
    },
    {
        title: "Ø§Ø®ØªÙØ§Ø¡ ÙÙŠ Ù…Ù‡Ø±Ø¬Ø§Ù†",
        story: "ÙÙŠ Ø§Ù„Ø²Ø­Ù…Ø©ØŒ ÙˆØ§Ø­Ø¯ ØªÙ‚ØªÙ„.",
        killerDesc: "Ø§Ù„Ù„ÙŠ ÙƒØ§Ù† Ù…Ø§Ø³Ùƒ Ø§Ù„Ø³Ù…Ø§Ø¹Ø§Øª",
        clues: ["ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ ÙÙŠÙ‡ ØªÙ‡Ø¯ÙŠØ¯.", "Ø³ÙƒÙŠÙ†Ø© ÙÙŠ Ø¬ÙŠØ¨ (Ø§Ù„Ù‚Ø§ØªÙ„).", "Ø¯Ù… Ø¹Ù„Ù‰ Ø­ÙˆØ§ÙŠØ¬ (Ø§Ù„Ù‚Ø§ØªÙ„).", "Ø´Ù‡ÙˆØ¯ Ø´Ø§ÙÙˆ Ø§Ù„Ø¹Ø±ÙƒØ©."],
        rumors: ["ÙƒØ§Ù† ÙŠØªØ¹Ø§Ø±Ùƒ.", "Ø§Ù„Ø²Ø­Ù…Ø© Ù‡ÙŠ Ø§Ù„Ø³Ø¨Ø¨."],
        secret: "Ù‚ÙˆÙ„ Ø§Ù„Ù„ÙŠ Ù‡ÙŠ Ø¹Ø±ÙƒØ© Ø¹Ø§Ø¯ÙŠØ©."
    },
    {
        title: "Ø§Ù„Ø®ÙŠØ§Ù†Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø©",
        story: "Ù…Ø¬Ù…ÙˆØ¹Ø© ØµØ­Ø§Ø¨ Ø¹Ø§Ù…Ù„ÙŠÙ† Ù…Ø´Ø±ÙˆØ¹ ÙƒØ¨ÙŠØ±. ÙˆØ§Ø­Ø¯ Ù…Ù†Ù‡Ù… ÙŠÙ„Ù‚Ù‰ Ø±ÙˆØ­Ùˆ Ù…ÙŠØª ÙÙŠ Ø§Ù„Ù…ÙƒØªØ¨.",
        killerDesc: "Ø§Ù„Ù„ÙŠ Ø¯Ø§ÙŠÙ…Ø§Ù‹ Ø³Ø§ÙƒØª ÙˆÙ…Ø§ ÙŠØªÙƒÙ„Ù…Ø´ Ø¨Ø±Ø´Ø§",
        clues: [
            "Ù…Ø§ ÙÙ…Ø§Ø´ ÙƒØ³Ø± ÙÙŠ Ø§Ù„Ø¨Ø§Ø¨.",
            "Ø¹Ù‚Ø¯ Ø´Ø±Ø§ÙƒØ© Ù…Ù…Ø²Ù‚.",
            "ØªØ³Ø¬ÙŠÙ„ ÙƒØ§Ù…ÙŠØ±Ø§ ÙŠÙˆØ±ÙŠ (Ø§Ù„Ù‚Ø§ØªÙ„) Ø¯Ø§Ø®Ù„ Ø¢Ø®Ø± ÙˆØ§Ø­Ø¯.",
            "Ø±Ø³Ø§Ù„Ø© ÙÙŠ ØªÙ„ÙÙˆÙ† (Ø§Ù„Ù‚Ø§ØªÙ„) ØªÙ‡Ø¯Ø¯ Ø§Ù„Ø¶Ø­ÙŠØ©."
        ],
        rumors: ["Ø§Ù„Ù…ÙˆØ¸Ù ÙŠØ³Ø±Ù‚.", "Ø§Ù„Ø¶Ø­ÙŠØ© Ø¹Ù†Ø¯Ùˆ Ø¹Ù„Ø§Ù‚Ø© Ø³Ø±ÙŠØ©."],
        secret: "Ø§Ø²Ø±Ø¹ Ø§Ù„Ø´Ùƒ ÙÙŠ Ø§Ù„Ù…ÙˆØ¸Ù."
    }
];

let players = {};
let gameStarted = false;
let currentMystery = null;
let currentClueIndex = 0;
let intervals = [];

app.get('/', (req, res) => { res.sendFile(path.join(__dirname, 'index.html')); });

function pickMystery(playerList) {
    // 1. Pick random mystery
    const template = mysteriesDB[Math.floor(Math.random() * mysteriesDB.length)];

    // 2. Pick random killer
    const killer = playerList[Math.floor(Math.random() * playerList.length)];

    // 3. Inject Killer Name into clues/story
    let finalClues = template.clues.map(c => c.replace("(Ø§Ù„Ù‚Ø§ØªÙ„)", killer.name));
    let finalRumors = template.rumors.map(r => r.replace("(Ø§Ù„Ù‚Ø§ØªÙ„)", killer.name));
    let finalSecret = template.secret ? template.secret.replace("(Ø§Ù„Ù‚Ø§ØªÙ„)", killer.name) : null;

    return {
        title: template.title,
        story: template.story,
        killer: killer.name,
        killerDesc: template.killerDesc, // Extra flavor text
        clues: finalClues,
        rumors: finalRumors,
        secretTask: finalSecret
    };
}

io.on('connection', (socket) => {

    socket.on('joinGame', (name) => {
        if (gameStarted) return socket.emit('errorMsg', 'Ø§Ù„Ø·Ø±Ø­ Ø¨Ø¯Ø§!');
        players[socket.id] = { id: socket.id, name: name, role: 'citizen', isDead: false, hasVoted: false };
        io.emit('updatePlayerList', Object.values(players));
    });

    socket.on('startGame', () => {
        const playerValues = Object.values(players);
        if (playerValues.length < 1) return io.emit('errorMsg', 'Ø²ÙŠØ¯ Ø¯Ø®Ù„ Ø¹Ø¨Ø§Ø¯!'); 

        // 1. Generate Local Mystery
        currentMystery = pickMystery(playerValues);

        gameStarted = true;
        intervals.forEach(clearInterval); intervals = [];
        currentClueIndex = 0;

        // 2. Assign Roles
        playerValues.forEach(p => {
            p.isDead = false; p.hasVoted = false;

            if (p.name === currentMystery.killer) {
                p.role = 'killer';
                io.to(p.id).emit('gameInit', { 
                    role: 'killer', 
                    title: currentMystery.title, 
                    story: currentMystery.story + "\nðŸ”´ ÙˆØµÙÙƒ: " + currentMystery.killerDesc 
                });
            } else {
                p.role = 'citizen';
                io.to(p.id).emit('gameInit', { 
                    role: 'citizen', 
                    title: currentMystery.title, 
                    story: currentMystery.story 
                });

                // Assign Secret Task to ONE innocent player
                if (currentMystery.secretTask && Math.random() > 0.5) {
                    io.to(p.id).emit('secretTask', currentMystery.secretTask);
                }
            }
        });

        io.emit('systemMessage', `ðŸš¨ **${currentMystery.title}** ðŸš¨\n${currentMystery.story}`);

        // 3. Loops
        startLoops();
    });

    function startLoops() {
        // Clues Loop (30s)
        const clueInt = setInterval(() => {
            if (!gameStarted) return;
            if (currentClueIndex < currentMystery.clues.length) {
                const clue = currentMystery.clues[currentClueIndex];
                io.emit('newClue', clue);
                io.emit('playAudio', "Ø¯Ù„ÙŠÙ„ Ø¬Ø¯ÙŠØ¯");
                currentClueIndex++;
            } else {
                clearInterval(clueInt);
                io.emit('systemMessage', "â›” ÙˆÙØ§Øª Ø§Ù„Ø£Ø¯Ù„Ø©! ÙˆÙ‚Øª Ø§Ù„ØªØµÙˆÙŠØª!");
                io.emit('startVoting');
                io.emit('playAudio', "ÙˆÙ‚Øª Ø§Ù„ØªØµÙˆÙŠØª");
            }
        }, 30000);
        intervals.push(clueInt);

        // Rumors Loop (Randomly send to one player)
        const rumorInt = setInterval(() => {
            if (!gameStarted) return;
            const rumor = currentMystery.rumors[Math.floor(Math.random() * currentMystery.rumors.length)];
            const pIds = Object.keys(players);
            const target = pIds[Math.floor(Math.random() * pIds.length)];
            io.to(target).emit('privateRumor', rumor);
        }, 25000);
        intervals.push(rumorInt);
    }

    socket.on('chatMessage', (msg) => {
        const p = players[socket.id];
        if (p && !p.isDead) io.emit('newChat', { name: p.name, msg: msg });
    });

    socket.on('killPlayer', (targetName) => {
        const killer = players[socket.id];
        if (!killer || killer.role !== 'killer' || killer.isDead) return;

        const targetId = Object.keys(players).find(k => players[k].name === targetName);
        if (targetId && !players[targetId].isDead) {
            players[targetId].isDead = true;
            io.emit('playerDied', { name: targetName });
            io.to(targetId).emit('youDied');
            io.emit('systemMessage', `ðŸš¨ **${targetName}** Ù…Ø§Øª Ù…Ù‚ØªÙˆÙ„!`);
            io.emit('playAudio', "Ø¬Ø±ÙŠÙ…Ø© Ù‚ØªÙ„");
            io.emit('startVoting');

            const alive = Object.values(players).filter(p => !p.isDead).length;
            if (alive <= 1) endGame('killer', killer.name);
        }
    });

    socket.on('votePlayer', (targetName) => {
        const p = players[socket.id];
        if (!p || p.hasVoted) return;
        p.hasVoted = true;
        // Logic simplification: just log vote
    });

    function endGame(winner, name) {
        gameStarted = false;
        intervals.forEach(clearInterval);
        io.emit('gameOver', { winner, msg: winner === 'killer' ? `ðŸ”ª Ø§Ù„Ù‚Ø§ØªÙ„ (${name}) Ø±Ø¨Ø­!` : `ðŸ‘® Ø§Ù„Ù…ÙˆØ§Ø·Ù†ÙŠÙ† Ø±Ø¨Ø­ÙˆØ§!` });
    }

    socket.on('disconnect', () => {
        delete players[socket.id];
        io.emit('updatePlayerList', Object.values(players));
        if (gameStarted && Object.keys(players).length < 1) {
             gameStarted = false; intervals.forEach(clearInterval);
        }
    });
});

server.listen(3000, () => console.log('Server 3000'));
